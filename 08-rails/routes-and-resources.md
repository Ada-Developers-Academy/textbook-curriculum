# Routes & Resources Review
## Learning Goals
- Revisit RESTful routing in Rails
- Learn about using the Rails `resources` route helpers

## Route Order
Rails routes are matched in the order they are specified. This can present a problem when a wildcard is used.

```ruby
get "/books/:id", to: "books#show"
get "/books/new", to: "books#new"
```

When Rails receives a request to `books/new` in this example, it will match the first route. Both of the routes above match `/books/new`! Rails doesn't know what `:id` means; it's not looking for an integer. It's looking for anything--including the word `new`--that matches the route. `books/new` in this case will route to the `BooksController#show` action. For the desired routes reorder the declarations:

```ruby
get "/books/new", to: "books#new"
get "/books/:id", to: "books#show"
```

That general rule is that routes go from most to least specific for any given resource.

## REST
Representational state transfer (REST) is an architectural style. This is a recommendation for the structure and style in which a resource (typically represented by a Model) can be represented and managed through a web server.

The core of this idea can be described through routing. For example, let's look at how to represent a `Book` resource:

| PATH         | METHOD | DESCRIPTION                                                                                    | Path Helper Name |
|--------------|--------|------------------------------------------------------------------------------------------------|------------------|
| /books     | GET    | Retrieves a collection of book objects.                                                       | books_path     |
| /books     | POST   | Creates a book object on the server.                                                         | books_path     |
| /books/:id | GET    | Retrieves an individual book object through an identifying attribute, given in the url path. | book_path(:id) |
| /books/:id | PATCH  | Updates an individual book object through an identifying attribute, given in the url path.   | book_path(:id) |
| /books/:id | PUT    | Updates an individual book object through an identifying attribute, given in the url path.   | book_path(:id) |
| /books/:id | DELETE | Removes an individual book object through an identifying attribute, given in the url path.   | book_path(:id) |

You can see that many actions can be performed on a book object using only two paths.
The paths represent the scope of the objects to operate on and the HTTP method indicates what type of action should be performed.

## Named Routes for REST
Since the standard RESTful resource only requires two paths, all five actions can be represented by just the two named routes.

The conventional route names for this RESTful resource would be `books_path` and `book_path`. We use the plural version when referring to a _collection_ of Book objects (`index` action), and the singular version when referring to an _instance_ or _specific_ Book (`show`, `edit`, etc).

Here's an example:

```erb
<% @books.each do |book| %>
  <%= link_to "Book Details", book_path(book) %>
<% end %>
```

## Resources
Rails has several _route helpers_ available. The most commons is the `resources` method which generates the default RESTful routes for the names resource:

```ruby
Rails.application.routes.draw do
  resources :books
end
```

This is equivalent to:

```ruby
Rails.application.routes.draw do
  get    "/books"          , to: "books#index",   as: :book
  post   "/books"          , to: "books#create"
  get    "/books/:id"      , to: "books#show",    as: :book
  patch  "/books/:id"      , to: "books#update"
  put    "/books/:id"      , to: "books#update"
  delete "/books/:id"      , to: "books#destroy"
  get    "/books/new"      , to: "books#new",     as: :new_book
  get    "/books/:id/edit" , to: "books#edit",    as: :edit_book
end
```

### Don't Get Lazy With `Resources`
Only ever use `resources` if you intend on implementing the full suite of RESTful routes for the resource. It's much more typical to only use a few of the routes generated by `resources`. For example, if a resource is meant to be read-only, we wouldn't need the `edit`, `create`, or `delete` routes.

To account for this, the `resources` route helper accepts options to limit the routes generated:

```ruby
Rails.application.routes.draw do
  # only generate the specified routes
  resources :books, only: [:index, :show]

  # generates every RESTful route _except_ for POST (create) and DELETE (destroy)
  resources :authors, except: [:create, :destroy]
end
```

## Exercise
Let's try out using `resources` in our TaskList project to see what will happen.

1. Run `rails routes` in your terminal. Make notes of what you see - either copy/paste the result or jot it down. Did your custom routes follow the standards listed in the table above?
1. Comment out all of your routes in the `routes.rb` file.
1. Add one line using `resources` and the name of your resource. (Most folks probably used "tasks", but we know not everyone did).
1. Run `rails routes` in your terminal again. Make notes of what is different from this version to the version that was created by your custom routes.
1. See if you can run your `rails server` and navigate to some of the pages you have set up. This will probably not work depending on how different your custom routes are from the standard set.

## Final Notes
- From now on, you are encouraged to use `resources` rather than defining each route "manually"
- When you look up Rails documentation on routing, most reference material uses `resources`
- Use `except` and `only` regularly to ensure you aren't creating extraneous routes that you will not use in your application
- Now it is even more important to be running `rails routes` regularly. Since the routes created are behind this new layer of abstraction, `rails routes` should help you clarify how your resources are set up.

## Resources
- [Official Rails Guide on Resources](http://guides.rubyonrails.org/routing.html#singular-resources)
